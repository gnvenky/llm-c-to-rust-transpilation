Translate the following C code to Rust.
Constraints:
- Preserve ABI compatibility
- Use #[repr(C)]
- Minimize unsafe blocks
- Convert error codes (-1) to Result<T, E>
- Use slices (&[u8]) instead of raw pointers where possible
